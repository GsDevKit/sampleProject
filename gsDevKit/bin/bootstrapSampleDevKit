#! /bin/bash -x
#=========================================================================
# Copyright (c) 2015 GemTalk Systems, LLC <dhenrich@gemtalksystems.com>.
#=========================================================================

usage() {
  cat <<HELP
USAGE: $(basename $0) [-h] <sample-project-git-root>
Bootstrap the Sample project. Clone the set of GitHub projects used by the
Sample project. Set up the tODe and GsDevKitHome infrastructure for the
Sample project in $GS_HOME based on the templates in <sample-project-git-root>.

This script should be run once to do the initial cloning of github 
repositories and to set up the sample project directory structure in 
$GS_HOME.

OPTIONS
  -h show usage

EXAMPLES
  $(basename $0) -h
  $(basename $0) $SAMPLE_HOME

HELP
}

set -e # exit on error
if [ "${GS_HOME}x" = "x" ] ; then
  echo "the GS_HOME environment variable needs to be defined"; exit 1
fi
source ${GS_HOME}/bin/shFunctions

if [ $# -ne 1 ]; then
  usage; exit 1
fi
sampleHome=$1

getOpts_help $@ #parse standard (-h) options

# clone git repositories
cd $sampleHOME/gsDevKit/git
if [ ! -d glass ]; then
  git clone git@github.com:glassdb/glass.git
fi
if [ ! -d Grease ]; then
  git clone git@github.com:GsDevKit/Grease.git
fi
if [ ! -d metacello-work ]; then
  git clone git@github.com:dalehenrich/metacello-work.git
fi
if [ ! -d sample ]; then
  git clone --branch gsDevKitHome git@github.com:dalehenrich/sample.git
fi
if [ ! -d Seaside31 ]; then
  git clone git@github.com:GsDevKit/Seaside31.git
fi
if [ ! -d tode ]; then
  git clone --branch dev git@github.com:dalehenrich/tode.git
fi
if [ ! -d zinc ]; then
  git clone git@github.com:GsDevKit/zinc.git
fi

# copy project entries to /sys/local/projects directory - referencing local git clones
cp $sampleHOME/gsDevKit/tode/sys/local/projects/* $GS_HOME/tode/sys/local/projects

# Setting things up to bootstrap GemStone and Pharo from local git clones
#   Copy GemStone bootstrap scripts to $GS_HOME/tode/sys/local/server/scripts and 
#   Pharo client bootstrap script to $GS_HOME/pharo
cp $sampleHOME/gsDevKit/tode/sys/local/server/scripts/* $GS_HOME/tode/sys/local/server/scripts
cp $sampleHOME/gsDevKit/pharo/todeLode.st $GS_HOME/pharo
